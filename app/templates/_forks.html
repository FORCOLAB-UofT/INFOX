    
<script type="text/javascript"> var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }}; </script>

<script type="text/javascript">   
    $(function() {
        var add_form = function(e) {
            var tag_obj = $(this).parents('.tag')
            var tag_list = tag_obj.find('span[id="tag_list"]')
            var input_tag = $(this).siblings('input[name="add"]')
            $.getJSON($SCRIPT_ROOT + '/_fork_edit_tag', {
                full_name: tag_obj.attr('id'),
                oper: 'add',
                tag: input_tag.val(),
            }, function(data) {
                tag_list.text(data.tags);
                input_tag.val('')
            });
            return false;
        };
        var clear_form = function(e) {
            var tag_obj = $(this).parents('.tag')
            var tag_list = tag_obj.find('span[id="tag_list"]')
            $.getJSON($SCRIPT_ROOT + '/_fork_edit_tag', {
                full_name: tag_obj.attr('id') ,
                oper: 'clear',
            }, function(data) {
                tag_list.text(data.tags);
            });
            return false;
        };
        $('.tag a#add').bind('click', add_form);
        $('.tag a#clear').bind('click', clear_form);
    });
</script>

<script>
$(document).ready(function() {
    // Setup - add a text input to each footer cell
    $('#forks-list tfoot th').each( function () {
        var title = $('#forks-list tfoot th').eq( $(this).index() ).text();
        $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
    } );

    // DataTable
    var table = $('#forks-list').DataTable({
        "bFilter": true,
        "bSort": true,
        "order": [[ 6, "desc" ]],
        "bAutoWidth": true,   
    });

    // Apply the search
    table.columns().eq( 0 ).each( function ( colIdx ) {
        $( 'input', table.column( colIdx ).footer() ).on( 'keyup change', function () {
            table
                .column( colIdx )
                .search( this.value )
                .draw();
        } );
    } );

} );

</script>


<style type="text/css">
    tr.change:hover
    {
        background-color:rgba(20, 157, 221, 0.166)
    }
</style>

<table id="forks-list" class="table table-responsive table-bordered table-hover" width="100%" cellspacing="0">
    <thead>
        <tr>
            <th>Fork Full Name</th>
            <th>Commits</th>
            <th>Files of Changed</th>
            <th>Lines of Changed</th>
            <th>Tags</th>
            <th>Key Words</th>
            <th>Last Committed</th>
            <th>Created At</th>
        </tr>
    </thead>
    
    <tfoot>
        <tr>
            <th>Fork Full Name</th>
            <th>Commits</th>
            <th>Files of Changed</th>
            <th>Lines of Changed</th>
            <th>Tags</th>
            <th>Key Words</th>
            <th>Last Committed</th>
            <th>Created At</th>
        </tr>
    </tfoot>

    <tbody>
        {% for fork in forks %}
        <tr class="change">
            <td><a href="{{ "https://github.com/" + fork.fork_name + "/compare" }}"> {{ fork.fork_name }} </a>
            </td>
            <td>
                <div class="dropdown show">
                  <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="commit_list" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {{ fork.total_commit_number }}
                  </a>

                  <div class="dropdown-menu" aria-labelledby="commit_list">
                    {% for commit in fork.commit_list %}
                        <a class="dropdown-item" href="{{ commit["link"] }}">{{ commit["title"] }}</a>
                    {% endfor %}
                  </div>
                </div>                  
            </td>

            <td>
                <div class="dropdown show">
                  <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="fork_chanegd_file_list" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {{ fork.total_changed_file_number }}
                    <span class="caret"></span>
                  </a>

                  <div class="dropdown-menu" aria-labelledby="fork_chanegd_file_list">
                    {% for file_name in fork.file_list %}
                        <a class="dropdown-item" href="{{ all_changed_files[(fork.fork_name, file_name)].diff_link }}">{{ "+%d %s" % (all_changed_files[(fork.fork_name, file_name)].changed_line_number, file_name) }}</a>
                    {% endfor %}
                  </div>
                </div>                  
            </td>

            <td>
                {{ fork.total_changed_line_number }}
            </td>
            
            <td style="word-break:break-all;">
                <div class="tag" id="{{ fork.full_name }}">
                    <span id="tag_list" style="float:left;">
                        {{ ",".join(fork.tags) }}
                    </span>
                    {% if current_user.is_authenticated %}
                    <div class="dropdown">
                        <button class="btn btn-default btn-xs" type="button" id="edit_tag_list" data-target="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            <span class="fa fa-pencil" aria-hidden="true"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="edit_tag_list">
                            <input type="text" size="7" name="add">
                            <a href=# id="add">add</a>
                            <a href=# id="clear">clear-all</a>
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </td>

            <td style="word-break:break-all;">
                {{ ", ".join(fork.key_words_lemmatize_tfidf[:6]) }}</td>
            </td>

            <td>{{ fork.last_committed_time.strftime('%Y-%m-%d') }}</td>

            <td>{{ fork.created_time.strftime('%Y-%m-%d') }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
